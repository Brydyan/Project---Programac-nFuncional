<div class="profile-container" *ngIf="!loading && user as u; else loadingTpl">
  <h1 class="profile-main-title">Perfil del Usuario</h1>

  <!-- INFORMACI√ìN PERSONAL -->
  <section class="profile-section">
    <div class="section-header">
      <h2>Informaci√≥n Personal</h2>
      <button class="edit-btn" (click)="toggleEditProfile()">
        {{ editingProfile ? 'Cancelar' : 'Editar Perfil' }}
      </button>
    </div>

    <div class="profile-card">
      <div class="profile-avatar-section">
        <div class="avatar-wrapper">
          <img 
            [src]="avatarPreview || u.avatarUrl || 'https://i.pravatar.cc/150?u=' + u.id" 
            alt="Avatar de usuario"
            class="profile-avatar"
          />

          <span class="status-indicator active"></span>

          <!-- input de archivo solo cuando est√°s editando -->
          <label *ngIf="editingProfile" class="avatar-edit-label">
            Cambiar foto
            <input
              type="file"
              accept="image/*"
              (change)="onAvatarSelected($event)"
              hidden
            />
          </label>
        </div>

        <div class="profile-info">
          <h3 class="profile-name" *ngIf="!editingProfile; else editNameTpl">
            {{ u.displayName || u.username }}
          </h3>

          <ng-template #editNameTpl>
            <input
              type="text"
              [(ngModel)]="u.displayName"
              class="profile-name-input"
              placeholder="Nombre visible"
            />
          </ng-template>

          <span class="status-badge" *ngIf="!editingProfile; else editStatusTpl">
            <span class="status-icon">‚úì</span>
            {{ u.statusMessage || 'Activo' }}
          </span>

          <ng-template #editStatusTpl>
            <input
              type="text"
              [(ngModel)]="u.statusMessage"
              class="status-input"
              placeholder="Estado (Disponible, Ocupado, etc.)"
            />
          </ng-template>
        </div>
      </div>

      <div class="bio-section">
        <h4 class="bio-label">Biograf√≠a</h4>

        <p class="bio-text" *ngIf="!editingProfile; else editBioTpl">
          {{ u.bio || 'Sin biograf√≠a todav√≠a. Puedes a√±adir una aqu√≠.' }}
        </p>

        <ng-template #editBioTpl>
          <textarea
            [(ngModel)]="u.bio"
            rows="3"
            class="bio-textarea"
            placeholder="Escribe algo sobre ti..."
          ></textarea>
        </ng-template>
      </div>
    </div>
  </section>

  <!-- INFORMACI√ìN DE CONTACTO -->
  <section class="profile-section">
    <div class="section-header">
      <h2>Informaci√≥n de Contacto</h2>
      <button class="edit-btn" (click)="toggleEditContact()">
        {{ editingContact ? 'Cancelar' : 'Editar Contacto' }}
      </button>
    </div>

    <div class="profile-card">
      <div class="contact-item">
        <span class="contact-icon">üìß</span>
        <div class="contact-details">
          <p class="contact-label">Correo Electr√≥nico</p>

          <p class="contact-value" *ngIf="!editingContact; else editEmailTpl">
            {{ u.email }}
          </p>

          <ng-template #editEmailTpl>
            <input
              type="email"
              [(ngModel)]="u.email"
              class="contact-input"
              placeholder="correo@ejemplo.com"
            />
          </ng-template>
        </div>
      </div>

      <div class="contact-item">
        <span class="contact-icon">üì±</span>
        <div class="contact-details">
          <p class="contact-label">Tel√©fono</p>
          <!-- a√∫n no existe phone en el modelo, mostramos placeholder -->
          <p class="contact-value">No registrado</p>
        </div>
      </div>
    </div>
  </section>

  <!-- PREFERENCIAS (solo info, editable desde Configuraci√≥n) -->
  <section class="profile-section">
    <div class="section-header">
      <h2>Preferencias</h2>
      <button class="edit-btn" (click)="onEditPreferences()">
        Abrir Configuraci√≥n
      </button>
    </div>

    <div class="profile-card">
      <p class="preferences-note">
        Las preferencias de notificaciones, tema e idioma se editan desde la
        pantalla de Configuraci√≥n.
      </p>
    </div>
  </section>

  <!-- BOTONES DE ACCI√ìN -->
  <div class="action-buttons" *ngIf="editingProfile || editingContact">
    <button class="btn-cancel" type="button" (click)="cancelEdits()">Cancelar</button>
    <button class="btn-primary" type="button" (click)="saveProfile()">Guardar cambios</button>
  </div>

  <div class="action-buttons" *ngIf="!editingProfile && !editingContact">
    <button class="btn-primary" type="button" (click)="onBackToChat()">Volver a Chat</button>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="profile-container">
    <h1 class="profile-main-title">Perfil del Usuario</h1>
    <p *ngIf="loading">Cargando perfil...</p>
    <p *ngIf="!loading && error" class="error-text">{{ error }}</p>
  </div>
</ng-template>
