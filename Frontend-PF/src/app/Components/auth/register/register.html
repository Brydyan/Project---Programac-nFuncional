<form [formGroup]="registerForm" (ngSubmit)="onRegisterSubmit()" novalidate>

  <div class="logo-container">
    <h1><span class="logo-icon">游눫</span> YARG Flow</h1>
    <h2 class="form-title">Crear una cuenta</h2>
  </div>

  <!-- Email -->
  <div class="form-group">
    <label for="email">Correo electr칩nico</label>
    <input id="email" formControlName="email" type="email" placeholder="correo@ejemplo.com"
      autocomplete="email" pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
      (keydown.enter)="focusNextTo('nombre')" />

    @if (email?.invalid && email?.touched) {
      <div class="error-message">Correo electr칩nico inv치lido.</div>
    }
  </div>

  <!-- Nombre -->
  <div class="form-group">
    <label for="nombre">Nombre</label>
    <input id="nombre" formControlName="nombre" type="text"
      placeholder="Tu nombre completo"
      (keydown.enter)="focusNextTo('alias')" />
  </div>

  <!-- Alias -->
  <div class="form-group">
    <label for="alias">Alias</label>
    <input id="alias" formControlName="alias" type="text"
      placeholder="Tu alias o apodo" autocomplete="username"
      (keydown.enter)="focusNextTo('password')" />

    @if(alias?.touched && alias?.invalid){
      <div class="error-message" *ngIf="alias?.errors?.['minlength']">M칤nimo 3 caracteres.</div>
      <div class="error-message" *ngIf="alias?.errors?.['pattern']">Solo letras, n칰meros, puntos o gui칩n bajo.</div>
    }
  </div>

  <!-- Password -->
  <div class="form-group">
    <label for="password">Contrase침a</label>

    <input id="password" [type]="showPassword ? 'text':'password'"
      formControlName="password" placeholder="Contrase침a"
      autocomplete="new-password"
      (keydown.enter)="focusNextTo('confirmPassword')" />

    @if (password?.touched && password?.invalid) {

      <div class="error-message" *ngIf="password?.errors?.['required']">
        La contrase침a es requerida.
      </div>

      <div class="error-message" *ngIf="password?.errors?.['minlength']">
        M칤nimo 8 caracteres.
      </div>

      <div class="error-message" *ngIf="password?.errors?.['pattern']">
        Debe contener:
        <ul>
          <li>1 letra may칰scula</li>
          <li>1 n칰mero</li>
          <li>1 car치cter especial (@$!%*?&...)</li>
        </ul>
      </div>
    }
  </div>

  <!-- Confirm Password -->
  <div class="form-group">
    <label for="confirmPassword">Confirmar Contrase침a</label>

    <input id="confirmPassword" [type]="showPassword ? 'text' : 'password'"
      formControlName="confirmPassword" placeholder="Confirmar contrase침a"
      autocomplete="new-password"
      (keydown.enter)="focusNextTo('day')" />

    @if (registerForm.hasError('mismatch') && confirmPassword?.touched) {
      <div class="error-message">Las contrase침as no coinciden.</div>
    }
  </div>

  <label class="checkbox-label">
    <input type="checkbox" (change)="toggleShowPassword()" /> Mostrar Contrase침a
  </label>

  <!-- Fecha de nacimiento -->
  <div class="form-group">
    <label>Fecha de nacimiento</label>

    <div class="date-group">
      <input id="day" formControlName="day" type="text" placeholder="dd"
        maxlength="2" inputmode="numeric" pattern="[0-9]*"
        (input)="onDigitsInput($event, 'month', 2)"
        (keydown.enter)="focusNextTo('month')" />

      <input id="month" formControlName="month" type="text" placeholder="mm"
        maxlength="2" inputmode="numeric" pattern="[0-9]*"
        (input)="onDigitsInput($event, 'year', 2)"
        (keydown.enter)="focusNextTo('year')" />

      <input id="year" formControlName="year" type="text" placeholder="aaaa"
        maxlength="4" inputmode="numeric" pattern="[0-9]*"
        (input)="onDigitsInput($event, 'submitBtn', 4)"
        (keydown.enter)="focusNextTo('submitBtn')" />
    </div>

    @if (registerForm.touched) {

      <div class="error-message" *ngIf="registerForm.hasError('invalidDate')">
        Ingresa una fecha v치lida.
      </div>

      <div class="error-message" *ngIf="registerForm.hasError('invalidDay')">
        El d칤a debe estar entre 1 y 31.
      </div>

      <div class="error-message" *ngIf="registerForm.hasError('invalidMonth')">
        El mes debe estar entre 1 y 12.
      </div>

      <div class="error-message" *ngIf="registerForm.hasError('invalidYear')">
        El a침o es inv치lido.
      </div>

      <div class="error-message" *ngIf="registerForm.hasError('nonexistentDate')">
        La fecha no existe.
      </div>

      <div class="error-message" *ngIf="registerForm.hasError('tooYoung')">
        Debes tener al menos 13 a침os.
      </div>

      <div class="error-message" *ngIf="registerForm.hasError('tooOld')">
        Fecha demasiado antigua.
      </div>
    }
  </div>

  <button id="submitBtn" type="submit"
    [disabled]="registerForm.invalid || isLoading">
    Registrar cuenta
  </button>

  <div *ngIf="isLoading" class="info-message">Registrando...</div>
  <div *ngIf="message" class="info-message">{{ message }}</div>
</form>
