<!-- src/app/pages/dashboard/conversations/conversations.html -->

<div class="conversations-wrapper">
  <!-- Barra superior -->
  <div class="conversations-header">
    <div class="tabs">
      <button class="tab active">Conversaciones</button>
      <button class="tab">Canales</button>
      <button class="tab">Settings</button>
    </div>

    <button class="new-conversation-btn" (click)="newConversation()">
      + Nueva Conversaci√≥n
    </button>
  </div>

  <h2 class="conversations-title">Conversaciones</h2>

  <!-- Estado: cargando -->
  <div class="loading" *ngIf="loading">
    Cargando conversaciones...
  </div>

  <!-- Estado: error -->
  <div class="error" *ngIf="!loading && error">
    {{ error }}
  </div>

  <!-- LISTA COMPLETA DE CONVERSACIONES -->
  <div
    class="conversations-list"
    *ngIf="!loading && !error && conversations.length > 0"
  >
    <button
      class="conversation-card"
      *ngFor="let conv of conversations"
      type="button"
      (click)="openConversation(conv)"
      [class.active]="conv.id === selectedConversationId"
    >
      <!-- Avatar con fallback -->
      <div class="conversation-avatar">
        <img
          [src]="conv.avatarUrl || ('https://i.pravatar.cc/100?u=' + conv.id)"
          [alt]="conv.name"
        />
      </div>

      <div class="conversation-main">
        <!-- L√≠nea superior: nombre + hora -->
        <div class="conversation-header-line">
          <span class="conversation-name">{{ conv.name }}</span>
          <span class="conversation-time">{{ conv.lastTimeLabel }}</span>
        </div>

        <!-- L√≠nea inferior: √∫ltimo mensaje + badge no le√≠dos -->
        <div class="conversation-footer-line">
          <span class="conversation-message">
            {{ conv.lastMessage || 'Sin mensajes a√∫n' }}
          </span>

          <span
            *ngIf="conv.unreadCount > 0"
            class="conversation-unread-badge"
          >
            {{ conv.unreadCount }}
          </span>
        </div>
      </div>
    </button>
  </div>

  <!-- Vac√≠o -->
  <div
    class="empty-conversations"
    *ngIf="!loading && !error && conversations.length === 0"
  >
    <h3>No tienes conversaciones todav√≠a</h3>
    <p>Inicia una nueva conversaci√≥n con el bot√≥n de arriba.</p>
  </div>

  <!-- Footer -->
  <div class="conversations-footer">
    <span>Enlaces R√°pidos</span>
    <span>¬∑</span>
    <span>Soporte</span>
  </div>
</div>

<!-- PANEL DE NUEVA CONVERSACI√ìN -->
<div class="new-conversation-layer" *ngIf="showNewConversation">
  <div class="new-conversation-backdrop" (click)="closeNewConversation()"></div>

  <div class="new-conversation-panel" (click)="$event.stopPropagation()">
    <header class="new-conversation-header">
      <div class="header-titles">
        <h3>Iniciar nueva conversaci√≥n</h3>
        <p>Busca un usuario por nombre o @usuario para empezar a chatear.</p>
      </div>

      <button class="close-btn" type="button" (click)="closeNewConversation()">
        ‚úï
      </button>
    </header>

    <!-- Buscador -->
    <div class="new-conversation-search">
      <span class="search-icon">üîç</span>
      <input
        type="text"
        placeholder="Buscar por nombre o @usuario"
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
      />
    </div>

    <!-- Resultados -->
    <div class="new-conversation-results">
      <p class="empty-hint" *ngIf="!searchTerm">
        Escribe para buscar personas‚Ä¶
      </p>

      <p class="empty-hint" *ngIf="searchTerm && searchResults.length === 0">
        No se encontraron usuarios para "{{ searchTerm }}".
      </p>

      <button
        *ngFor="let user of searchResults"
        type="button"
        class="search-result-item"
        (click)="startConversationWith(user)"
      >
        <div class="avatar">
          <img
            [src]="user.avatarUrl || ('https://i.pravatar.cc/100?u=' + user.id)"
            [alt]="user.displayName"
          />
        </div>

        <div class="user-main">
          <span class="user-name">{{ user.displayName }}</span>
          <span class="user-username">@{{ user.username }}</span>
        </div>
      </button>
    </div>
  </div>
</div>
