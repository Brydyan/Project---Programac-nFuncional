<div class="chat-window">

  <!-- HEADER CON INFO DEL CONTACTO -->
  <header class="chat-header">
    <div class="chat-header-left">
      <div class="avatar">
        <img
          [src]="contactAvatarUrl || ('https://i.pravatar.cc/100?u=' + contactId)"
          alt="Avatar"
        />
      </div>
      <div class="contact-info">
        <!-- aquÃ­ usamos el alias/nombre real -->
        <div class="contact-name">
          {{ contactDisplayName || 'Chat 1 a 1' }}
        </div>
        <div class="contact-status" [ngClass]="{ 'online': contactPresence === 'ONLINE', 'inactive': contactPresence === 'INACTIVE', 'offline': contactPresence === 'OFFLINE' }">{{ contactStatusLabel }}</div>
      </div>
    </div>

    <div class="chat-header-right">
      <button class="icon-btn" type="button">ğŸ“</button>
      <button class="icon-btn" type="button">ğŸ¥</button>
      <button class="icon-btn" type="button">â‹¯</button>
    </div>
  </header>

  <!-- ZONA DE MENSAJES -->
  <main class="chat-body" id="chat-thread-messages">

    <!-- mientras carga -->
    <div *ngIf="loading" class="loading">
      Cargando conversaciÃ³n...
    </div>

    <!-- sin mensajes (despuÃ©s de cargar) -->
    <div
      *ngIf="!loading && messages.length === 0"
      class="empty-state"
    >
      <div class="empty-title">Empieza la conversaciÃ³n</div>
      <div class="empty-subtitle">
        EnvÃ­a el primer mensaje para iniciar el chat.
      </div>
    </div>

    <!-- lista de mensajes -->
    <div
      *ngFor="let msg of messages"
      class="message-row"
      [ngClass]="{
        'message-row--right': isMine(msg),
        'message-row--left': !isMine(msg)
      }"
    >
      <div
        class="message-bubble"
        [ngClass]="{
          'message-bubble--right': isMine(msg),
          'message-bubble--left': !isMine(msg)
        }"
      >
        <div *ngIf="msg.content">
          <p>{{ msg.content }}</p>
        </div>

        <div *ngIf="msg.attachmentUrl" class="message-attachment">
          <img *ngIf="msg.attachmentMime?.startsWith('image/')" [src]="msg.attachmentUrl" class="attachment-thumb" (click)="openAttachment(msg.attachmentUrl)" />
          <div *ngIf="!(msg.attachmentMime?.startsWith('image/'))">
            <a [href]="msg.attachmentUrl" target="_blank" rel="noopener">{{ msg.attachmentName || 'Archivo' }}</a>
          </div>
        </div>

        <span class="message-time">
          {{ msg.timestamp | date:'shortTime' }}
        </span>
      </div>
    </div>

  </main>

  <!-- INPUT DE MENSAJE -->
  <footer class="chat-input-area">
    <div class="input-wrapper">
      <button class="attach-btn" type="button" (click)="onSelectImageClick()">ğŸ–¼ï¸</button>
      <button class="attach-btn" type="button" (click)="onSelectFileClick()">ğŸ“</button>
      <input id="file-input-image" type="file" accept="image/*" style="display:none" (change)="onFileSelected($event, true)" />
      <input id="file-input-file" type="file" style="display:none" (change)="onFileSelected($event, false)" />
      <input
        type="text"
        placeholder="Escribe tu mensaje aquÃ­..."
        [(ngModel)]="newMessage"
        (keyup.enter)="sendMessage()"     
      />
      <button
        class="send-btn"
        type="button"
        (click)="sendMessage()"
        [disabled]="attaching"
      >
        <span *ngIf="!attaching">â¤</span>
        <span *ngIf="attaching" class="spinner" aria-hidden="true"></span>
      </button>
    </div>
  </footer>

  <div class="chat-footer-links">
    <span>Enlaces RÃ¡pidos</span>
    <span>Â·</span>
    <span>Soporte</span>
  </div>
</div>
