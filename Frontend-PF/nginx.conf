server {
    listen 80;

    # Directorio donde están los archivos de Angular
    root /usr/share/nginx/html;
    index index.html;

    # 1. Regla SPA: Si el archivo no existe, redirige a index.html.
    #    Esto permite que el router de Angular se encargue de la ruta.
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 2. Regla PROXY (Backend): Cualquier petición a /api/ la enviamos al servicio Java.
    #    Usamos el nombre del servicio Docker: "backend".
    location /api/ {
        # Reescribe la ruta quitando '/api/' antes de enviarla al backend
        rewrite ^/api/(.*)$ /$1 break;
        
        # Envía la petición al backend en el puerto 8080
        proxy_pass http://backend:8080;
    }
}