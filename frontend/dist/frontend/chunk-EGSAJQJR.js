import{a as A}from"./chunk-PPUZVKXG.js";import{a as z}from"./chunk-5APZ7EMV.js";import{a as F}from"./chunk-DYV3ILQ6.js";import{a as V}from"./chunk-4N7PJ33N.js";import{b as D,d as T,g as N,q as R}from"./chunk-EHQ257GK.js";import{i as j}from"./chunk-DTPHU4DJ.js";import{Ea as g,Ja as C,Mb as E,Na as f,Nb as k,Pb as w,Qb as I,Wa as p,Xa as i,Ya as r,Z as m,_ as u,bb as _,cb as h,eb as c,gb as a,hb as b,ib as x,jb as v,kb as S,lb as y,qb as P,sb as M,ua as l,zb as O}from"./chunk-GOBX2HRP.js";function J(o,n){o&1&&(i(0,"div",11)(1,"p"),a(2,"Cargando canales..."),r()())}function L(o,n){if(o&1&&(i(0,"div",12)(1,"p"),a(2),r()()),o&2){let e=c();l(2),b(e.error)}}function B(o,n){o&1&&(i(0,"div",13)(1,"p"),a(2,"No hay canales disponibles."),r()())}function W(o,n){if(o&1){let e=_();i(0,"div",16)(1,"div",17)(2,"div",18),a(3,"\u{1F4E2}"),r(),i(4,"h2",19),a(5),r()(),i(6,"p",20),a(7),r(),i(8,"p",20),a(9),r(),i(10,"p",20),a(11),P(12,"date"),r(),i(13,"button",21),h("click",function(){let s=m(e).$implicit,d=c(2);return u(d.openChannel(s))}),a(14,"Ver Canal"),r()()}if(o&2){let e=n.$implicit;l(5),b(e.name),l(2),x("\u{1F465} ",e.members.length," miembros"),l(2),x("\u{1F510} Tipo: ",e.type),l(2),x("\u{1F4C5} Creado: ",M(12,4,e.createdAt,"medium"))}}function H(o,n){if(o&1&&(i(0,"div",14),f(1,W,15,7,"div",15),r()),o&2){let e=c();l(),p("ngForOf",e.channels)}}function $(o,n){o&1&&(i(0,"p",33),a(1," No se encontraron canales p\xFAblicos. "),r())}function Y(o,n){if(o&1){let e=_();i(0,"button",34),h("click",function(){let s=m(e).$implicit,d=c(2);return u(d.joinSelectedChannel(s))}),i(1,"div",35),a(2,"\u{1F4E2}"),r(),i(3,"div",36)(4,"span",37),a(5),r(),i(6,"span",38),a(7),r()()()}if(o&2){let e=n.$implicit;l(5),b(e.name),l(2),x("",e.members.length," miembros")}}function G(o,n){if(o&1){let e=_();i(0,"div",22),h("click",function(){m(e);let s=c();return u(s.closeJoinPanel())}),i(1,"div",23),h("click",function(s){return m(e),u(s.stopPropagation())}),i(2,"header",24)(3,"div",25)(4,"h3"),a(5,"Unirse a un Canal P\xFAblico"),r(),i(6,"p"),a(7,"Selecciona un canal p\xFAblico para unirte."),r()(),i(8,"button",26),h("click",function(){m(e);let s=c();return u(s.closeJoinPanel())}),a(9,"\u2715"),r()(),i(10,"div",27)(11,"span",28),a(12,"\u{1F50D}"),r(),i(13,"input",29),y("ngModelChange",function(s){m(e);let d=c();return S(d.joinSearch,s)||(d.joinSearch=s),u(s)}),h("input",function(){m(e);let s=c();return u(s.onJoinSearchChange())}),r()(),i(14,"div",30),f(15,$,2,0,"p",31)(16,Y,8,2,"button",32),r()()()}if(o&2){let e=c();l(13),v("ngModel",e.joinSearch),l(2),p("ngIf",e.searchResults.length===0),l(),p("ngForOf",e.searchResults)}}var U=class o{constructor(n,e,t,s,d,q){this.router=n;this.channelService=e;this.sessionService=t;this.channelEvents=s;this.realtime=d;this.cdr=q}channels=[];loading=!0;initialLoadDone=!1;error=null;currentUserId=null;showJoinPanel=!1;joinSearch="";searchResults=[];eventsSub;wsSub;ngOnInit(){let n=localStorage.getItem("token");if(!n){this.loading=!1,this.error="No se encontr\xF3 token de sesi\xF3n";return}this.sessionService.getByToken(n).subscribe({next:e=>{this.currentUserId=e.userId,this.loadChannels(!0),this.currentUserId&&(this.eventsSub=this.channelEvents.refresh$.subscribe(()=>this.loadChannels(!1)),this.wsSub=this.realtime.subscribeToChannelEvents(this.currentUserId).subscribe({next:t=>this.applyChannelEvent(t),error:t=>console.error("WS Error:",t)}))},error:()=>{this.loading=!1,this.error="No se pudo obtener la sesi\xF3n",this.cdr.detectChanges()}})}ngOnDestroy(){this.eventsSub?.unsubscribe(),this.wsSub?.unsubscribe()}loadChannels(n){this.currentUserId&&(n&&!this.initialLoadDone&&(this.loading=!0,this.cdr.detectChanges()),this.channelService.getChannelsByMember(this.currentUserId).subscribe({next:e=>{this.channels=e.filter(t=>!!t.id),this.initialLoadDone=!0,this.loading=!1,this.cdr.detectChanges()},error:()=>{this.error="No se pudieron cargar los canales",this.loading=!1,this.cdr.detectChanges()}}))}applyChannelEvent(n){switch(n.type){case"CHANNEL_CREATED":this.channels=[n.payload,...this.channels];break;case"CHANNEL_DELETED":this.channels=this.channels.filter(t=>t.id!==n.payload.id);break;case"USER_ADDED_TO_CHANNEL":n.payload.userId===this.currentUserId&&(this.channels=[n.payload.channel,...this.channels]);break;case"NEW_CHANNEL_MESSAGE":let e=this.channels.findIndex(t=>t.id===n.payload.channelId);e>=0&&(this.channels[e].unread=(this.channels[e].unread||0)+1);break}this.cdr.detectChanges()}openJoinPanel(){this.showJoinPanel=!0,this.joinSearch="",this.searchResults=this.channels.filter(n=>n.type==="PUBLIC")}closeJoinPanel(){this.showJoinPanel=!1}onJoinSearchChange(){let n=(this.joinSearch||"").trim();if(!n){this.searchResults=[];return}this.channelService.searchPublic(n).subscribe({next:e=>this.searchResults=e,error:()=>this.searchResults=[]})}joinSelectedChannel(n){if(!this.currentUserId)return alert("Sesi\xF3n no encontrada");this.channelService.joinChannel(n.id,this.currentUserId).subscribe({next:()=>{this.channelEvents.emitRefresh(),this.closeJoinPanel()},error:e=>{console.error("Error al unirse",e),alert("Error al unirse al canal")}})}openChannel(n){console.log("Abrir canal:",n),this.router.navigate(["/dashboard/channel",n.id]),this.wsSub?.unsubscribe(),this.wsSub=this.realtime.subscribeToChannelEvents(this.currentUserId).subscribe(e=>this.applyChannelEvent(e))}goCreate(n){n.stopPropagation(),this.showJoinPanel=!1,this.router.navigate(["/dashboard/channel/create"])}static \u0275fac=function(e){return new(e||o)(g(j),g(z),g(V),g(A),g(F),g(O))};static \u0275cmp=C({type:o,selectors:[["app-channels"]],decls:14,vars:5,consts:[[1,"channels-container"],[1,"page-title"],[1,"top-actions"],[1,"action-buttons"],[1,"btn-join",3,"click"],[1,"btn-create",3,"click"],["class","loading-box",4,"ngIf"],["class","error-box",4,"ngIf"],["class","empty-box",4,"ngIf"],["class","channels-grid",4,"ngIf"],["class","join-panel-layer",3,"click",4,"ngIf"],[1,"loading-box"],[1,"error-box"],[1,"empty-box"],[1,"channels-grid"],["class","channel-card",4,"ngFor","ngForOf"],[1,"channel-card"],[1,"channel-header"],[1,"channel-icon"],[1,"channel-title"],[1,"channel-meta"],[1,"btn-view",3,"click"],[1,"join-panel-layer",3,"click"],[1,"join-panel",3,"click"],[1,"join-panel-header"],[1,"titles"],["type","button",1,"close-btn",3,"click"],[1,"join-search"],[1,"search-icon"],["type","text","placeholder","Buscar canales p\xFAblicos\u2026",3,"ngModelChange","input","ngModel"],[1,"join-results"],["class","empty-hint",4,"ngIf"],["class","join-item","type","button",3,"click",4,"ngFor","ngForOf"],[1,"empty-hint"],["type","button",1,"join-item",3,"click"],[1,"icon"],[1,"item-main"],[1,"item-name"],[1,"item-members"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"h1",1),a(2,"Canales"),r(),i(3,"div",2)(4,"div",3)(5,"button",4),h("click",function(){return t.openJoinPanel()}),a(6,"Unirse a un Canal"),r(),i(7,"button",5),h("click",function(d){return t.goCreate(d)}),a(8," \uFF0B Crear Nuevo Canal "),r()()(),f(9,J,3,0,"div",6)(10,L,3,1,"div",7)(11,B,3,0,"div",8)(12,H,2,1,"div",9),r(),f(13,G,17,3,"div",10)),e&2&&(l(9),p("ngIf",t.loading),l(),p("ngIf",!t.loading&&t.error),l(),p("ngIf",!t.loading&&!t.error&&t.channels.length===0),l(),p("ngIf",!t.loading&&!t.error&&t.channels.length>0),l(),p("ngIf",t.showJoinPanel))},dependencies:[I,E,k,R,D,T,N,w],styles:[".channels-container[_ngcontent-%COMP%]{padding:25px;color:#fff;font-family:system-ui}.page-title[_ngcontent-%COMP%]{font-size:30px;font-weight:700;margin-bottom:25px}.top-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.search-box[_ngcontent-%COMP%]{display:flex;align-items:center;background:#111;border:1px solid #333;padding:10px 15px;border-radius:10px;width:50%}.search-icon[_ngcontent-%COMP%]{margin-right:10px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:transparent;border:none;outline:none;color:#fff;width:100%}.action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:10px}.btn-join[_ngcontent-%COMP%]{background:#6a5cff;padding:10px 20px;border-radius:8px;border:none;color:#fff;font-weight:600;cursor:pointer}.btn-create[_ngcontent-%COMP%]{background:#111;border:1px solid #444;padding:10px 20px;border-radius:8px;color:#fff;cursor:pointer}.channels-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:22px}.channel-card[_ngcontent-%COMP%]{background:#1a1a1a;padding:25px;border-radius:12px;border:1px solid #2b2b2b;transition:.2s}.channel-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);border-color:#6a5cff}.channel-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.channel-icon[_ngcontent-%COMP%]{background:#fff;color:#000;width:42px;height:42px;border-radius:50%;display:grid;place-items:center;font-size:20px;margin-right:12px}.channel-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600}.channel-description[_ngcontent-%COMP%]{color:#ccc;font-size:14px;margin-bottom:15px}.channel-meta[_ngcontent-%COMP%]{font-size:13px;opacity:.7;margin-bottom:5px}.btn-view[_ngcontent-%COMP%]{width:100%;padding:10px 0;background:#000;color:#fff;border-radius:8px;cursor:pointer;border:1px solid #333;margin-top:12px}.join-panel-layer[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0f172ab3;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;justify-content:center;align-items:center;z-index:3000;animation:_ngcontent-%COMP%_fadeIn .2s ease-out}.join-panel[_ngcontent-%COMP%]{background:#020617;width:440px;max-height:80vh;padding:20px;border-radius:18px;border:1px solid rgba(148,163,184,.3);box-shadow:0 24px 80px #0f172ae6;display:flex;flex-direction:column;color:#e5e7eb;animation:_ngcontent-%COMP%_scaleIn .25s ease}.join-panel-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}.join-panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#f9fafb}.join-panel-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:2px 0 0;font-size:12px;color:#9ca3af}.join-panel-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{border:none;border-radius:999px;background:#111827;color:#e5e7eb;width:28px;height:28px;font-size:16px;cursor:pointer}.join-panel-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{background:#1f2937}.join-search[_ngcontent-%COMP%]{margin-top:12px;display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:999px;background:#020617;border:1px solid #374151}.join-search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;border:none;outline:none;background:transparent;color:#e5e7eb;font-size:14px}.join-results[_ngcontent-%COMP%]{margin-top:15px;flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:10px;padding-right:4px}.empty-hint[_ngcontent-%COMP%]{text-align:center;font-size:13px;color:#9ca3af}.join-item[_ngcontent-%COMP%]{border:none;background:#020617;border-radius:12px;padding:12px 14px;display:flex;align-items:center;gap:12px;cursor:pointer;box-shadow:0 0 0 1px #111827;transition:background .15s ease,box-shadow .15s ease,transform .1s ease}.join-item[_ngcontent-%COMP%]:hover{background:#0b1120;box-shadow:0 0 0 1px #4b5563;transform:translateY(-1px)}.join-item[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:#1f2937;font-size:16px}.item-main[_ngcontent-%COMP%]{display:flex;flex-direction:column}.item-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#f9fafb}.item-members[_ngcontent-%COMP%]{font-size:12px;color:#9ca3af}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scaleIn{0%{transform:scale(.92);opacity:0}to{transform:scale(1);opacity:1}}"]})};export{U as Channels};
